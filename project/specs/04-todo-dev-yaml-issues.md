# `yoda/todos/TODO.<dev>.yaml` and issues in Markdown

## Objective

Separate backlog metadata from rich issue descriptions.

## Preferred direction

- One TODO per person, in the format `yoda/todos/TODO.<dev>.yaml` (dev = developer slug).
- Each issue has its own Markdown file in `yoda/project/issues/`.
- `yoda/todos/TODO.<dev>.yaml` references the path of each issue Markdown file.
- Issue files contain only free text in the body (metadata goes in YAML front matter).
- A script creates the issue and the initial Markdown skeleton.

## Location and naming

- Issues folder: `yoda/project/issues/`
- Canonical issue id: `<dev>-<NNNN>` (example: `dev-0001`)
- Issue file name: `<id>-<slug>.md`
  - id = canonical id generated by the TODO script
  - slug = slug of the title (immutable after creation; renames require migration)

## Slug format (dev and issue)

- Use lowercase ASCII, digits, and hyphens only.
- Must start with a letter and contain no spaces.
- Examples: dev, ana-01, criar-yoda-yoda-md

## Canonical ID

- Canonical issue id: dev-#### (example: dev-0001)
- Use the canonical id in depends_on.
- IDs are unique across the repo (not only within a single TODO).
- Optional human alias (example: A-0001) is allowed only if a fixed prefix map exists per developer.

## Minimal schema for `yoda/todos/TODO.<dev>.yaml`

Root fields (required):

- schema_version: "1.01"
- developer_name: human-readable developer name
- developer_slug: developer slug used in the file name
- timezone: `UTC` or IANA TZ database name (Python `zoneinfo` compatible)
- updated_at
- issues: array of issue items (can be empty)

Each issue item must contain:

- id: canonical id (dev-####), generated by the script
- title: issue title
- slug: slug of the title (used in the issue file name)
- description: brief description of what needs to be done
- status: to-do | doing | done | pending
- priority: 0 to 10 (10 = highest priority; baseline/default 5)
- depends_on: list of ids
- pending_reason: reason for pending (required when status = pending)
- created_at, updated_at

Optional fields:

- origin: external issue reference (system, external_id, requester)

## Constraints

- schema_version uses semantic versioning (current: 1.01).
- developer_slug must match the slug rules (lowercase ASCII, digits, hyphens; start with a letter; no spaces).
- id must match `<developer_slug>-<####>` (4 digits).
- status must be one of: to-do, doing, done, pending.
- priority is an integer 0 to 10 (default 5 when not provided).
- priority baseline policy:
  - `5` is the default neutral baseline for new issues.
  - `0..4` means lower relative importance and `6..10` means higher relative importance compared to other open issues in the same TODO.
  - If priority is different from `5`, the issue Markdown should include a short comparative justification.
- timezone must be `UTC` or a valid IANA TZ database name compatible with Python `zoneinfo`.
- UTC SHOULD be used unless the project explicitly requires another timezone.
- created_at and updated_at use ISO 8601 with explicit timezone.
- depends_on must reference issues within the same developer TODO (no cross-dev dependencies).
- slug is immutable after creation; do not change it via update scripts.
- If a rename is required, perform an explicit migration (update TODO item, issue file name, and log path together).

Note: there is no owner; each dev has their own TODO.

## Status (definitions)

- to-do: created, not started yet
- doing: started in the YODA Flow for the issue
- done: YODA Flow cycle finished
- pending: blocker identified during YODA Flow; record the reason in pending_reason and keep on stand-by until resolved

## State machine

- to-do -> doing -> done
- Any state can transition to pending
- pending -> to-do or doing (via `todo_update.py`)

## Benefits

- Single source of truth for work state.
- Bulk operations are straightforward (list, filter, reorder).
- Token savings by sending only `yoda/todos/TODO.<dev>.yaml` for planning.
- Markdown stays free for narrative detail.

## Minimal identifier

The issue Markdown file must have a minimal identifier to link to `yoda/todos/TODO.<dev>.yaml`, for example:

- Use the ID in the Markdown title.

## Notes

- The AI must not edit `yoda/todos/TODO.<dev>.yaml` directly; it must call scripts.
- The AI can freely edit the issue text.

## Issue metadata (Markdown)

Issue files use YAML front matter that mirrors the issue metadata in `yoda/todos/TODO.<dev>.yaml`.

Rules:

- Front matter is required in issue Markdown files.
- Fields match the issue item schema.
- Scripts must copy updates from TODO to the issue metadata.

## Ordering rule (deterministic)

todo_next.py must select the next issue using:

1) priority (desc)
2) position in the YAML list (top to bottom)

Selection rules:

- If any issue is `doing`, no selection is allowed; `todo_next.py` must return a conflict error.
- Only issues with status `to-do` are selectable.
- Issues with status `pending` are not selectable; they must be reported with pending_reason.
- Issues with unresolved depends_on are not selectable.
- If no selectable issues exist, return an error that lists pending items and blocked dependencies.

## Minimal example (`yoda/todos/TODO.<dev>.yaml`)

```yaml
schema_version: "1.01"
developer_name: Alex
developer_slug: dev
timezone: "America/Sao_Paulo"
updated_at: "2026-01-21T19:40:50-03:00"

issues:
  - id: dev-0001
    title: Create yoda/yoda.md
    slug: criar-yoda-yoda-md
    description: Define root agent instructions for this repository.
    status: doing
    priority: 10
    depends_on: []
    created_at: "2026-01-21T18:46:15-03:00"
    updated_at: "2026-01-21T18:46:15-03:00"

  - id: dev-0002
    title: Issue templates usage guide
    slug: template-issue-regras-uso
    description: Document how agents should use issue templates.
    status: to-do
    priority: 8
    depends_on: [dev-0001]
    created_at: "2026-01-21T19:26:26-03:00"
    updated_at: "2026-01-21T19:26:26-03:00"

  - id: dev-0003
    title: Define scripts v1 interface
    slug: definir-scripts-v1
    description: Specify the v1 scripts interface and behavior.
    status: pending
    pending_reason: "Waiting for consensus on script naming."
    priority: 7
    depends_on: [dev-0001]
    created_at: "2026-01-21T19:17:35-03:00"
    updated_at: "2026-01-21T19:17:35-03:00"
```
